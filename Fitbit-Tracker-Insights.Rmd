---
title: "Fitbit-Tracker-Insights"
author: "Mithil Guru"
date: '2022-06-26'
output: html_document
---

# FITBIT TRACKER INSIGHTS

## INTRO

Fitbit is a fitness technology company that produces wearables to monitor daily health and activity data, such as heart rate, steps, sleep-quality, etc. There is a tremendous amount of data collected by these wearable devices daily that can be harnessed to benefit the consumer and the company. I will explore the Fitbit fitness tracker data Kaggle dataset (https://www.kaggle.com/arashnic/fitbit) for business insight as an extension of the Google Data Analytics Certificate Capstone Project. 

### OBJECTIVES

**1. Discover trends in usage**

**2. Generate recommendations for product strategy**



## METHODS

Checking the data first for validity and integrity. 
The data description indicates it is generated from respondents to a survey in 2016. It includes consented data from the personal trackers thirty users.

**DATA - Assessment**

Assessing the source of the data, it is likely not reliable as the sample size is only 30, the survey was conducted and compiled by a third-party organization, and the data may be slighlty inconsistent, due to the source including data from different trackers, and outdated as current trackers have improved capabilities. Additionally, there is a possibility of voluntary response bias due to the participants consenting to take place in the study, which may have influenced their habits during the course of the study. There is also no extra information provided about the participants, so the sample may not be truly representative of the general population.

Despite the limitations, the dataset is chosen for analysis since it is one of the few publicly available sources with Fitbit tracker data - most tracker data is locked for user privacy. The only alternative for reliable data would be to self-analyze Fitbit data with the use of the Fitbit API, but this limits study to one subject. 

**DATA - Summary**

The data includes 18 total datasets (CSV files) representing data collected by the trackers. A quick search through the files revealed that most of the data was collected and compiled in the dailyActivity.csv dataset, and the remaining files contain specific intervals or variations of the quantitative data. 

The datasets can be categorized as such - 

**Activity** - 

- dailyActivity

- dailySteps, hourlySteps, minuteSteps (Narrow & Wide)

- dailyIntensities, hourlyIntensities, minuteIntensities (Narrow & Wide)

**Sleep** - 

- sleepDay, minuteSleep

**Calories / Weight** - 

- dailyCalories, hourlyCalories, minuteCalories (Narrow & Wide)

- weightLogInfo

**Other** - 

- heartrate

- minuteMETs (Energy Expenditure)


Most of the data is explained in the dailyActivity file, and the sleepDay file provides additional information for analysis. The hourlySteps and hourlyIntensities datasets also supplement the daily activity data. The remaining datasets can be condensed. 

The weightLog, heartrate, and minuteSleep files do not contain data for all the subjects, and will not be considered as they do not meet minimum sample size requirements. The minuteMETs file does not provide relevant data for the business objective.

**DATA - Features** 
All variables are quantitative.

**Steps** - total steps per day

**Intensity** - sorted by level (Sedentary, Lightly Active, Moderately Active, Very Active) for distance and time

fitbit.com details the specifics of the activity intensity measurement - 
0 = sedentary time - likely hours spent seated at work/school.
1 = lightly active time - simple user walking throughout the day (i.e. walking around home, to and from work, etc.).
2, 3 = fairly active, very active time - likely specific workout/exercise activity (i.e. running, lifting, sports, etc.).

**Calories** - total calories burned per day

**Sleep** - total sleep sessions per day, minutes asleep, time in bed

The initial chosen datasets.
```{r}
# imports
library(tidyverse)
library(DataExplorer)

# data
df <- read_csv('Fitbit-Data/dailyActivity_merged.csv')
dfs <- read_csv('Fitbit-Data/sleepDay_merged.csv')

dfhs <- read_csv('Fitbit-Data/hourlySteps_merged.csv')
dfhi <- read_csv('Fitbit-Data/hourlyIntensities_merged.csv')

head(df)
head(dfs)
head(dfhs)
head(dfhi)
```
Using SQL (BigQuery database) to perform the initial data preparation and R (dplyr) for additional data transformation and visualizations. Finally, a Tableau dashbaord contains additional supplemental visualizations.



## FEATURE ENGINEERING

Transforming hourly activity data.
```{r}
# convert steps dataset to datetime format
dfhs <- dfhs %>% 
  rename(Datetime = ActivityHour) %>% 
  mutate(Datetime = as.POSIXct(Datetime, format = "%m/%d/%Y %I:%M:%S %p", tz = Sys.timezone())) %>% 
  # separate date and time
  separate(Datetime, into = c("Date", "Time"), sep = " ") 

# convert intensities dataset to datetime format
dfhi <- dfhi %>% 
  rename(Datetime = ActivityHour) %>% 
  mutate(Datetime = as.POSIXct(Datetime, format = "%m/%d/%Y %I:%M:%S %p", tz = Sys.timezone())) %>% 
  # separate date and time
  separate(Datetime, into = c("Date", "Time"), sep = " ")

head(dfhs)
head(dfhi)
```

Combining the activity datasets.
```{r}
# merge hourly steps and intensities datasets
dfh <- merge(dfhs, dfhi, by = c("Id", "Date", "Time"), all.x = TRUE) 

head(dfh)
```

Transforming sleep data (for parsing).
```{r}
# separate date and time
ds2 <- dfs %>% 
  separate(col = SleepDay,into = c("Date", "Time"), sep = " ", remove = TRUE)
head(ds2)
```

The data is now formatted for processing by SQL. 
```{r}
# exporting new csv
# write_csv(ds2, 'Fitbit-Data/daily_sleep.csv')
```

SQL Data Prep Objectives - check for distinct users, merge tables, remove missing values and duplicates, identify mistyped data, adjust columns.

Connecting to BigQuery database.
```{r}
library(bigrquery)
library(DBI)
con <- dbConnect(
  bigrquery::bigquery(),
  project = "fitbit-tracker-analysis",
  dataset = "daily_activity",
)
```

Finding the number of users for each table.
```{sql, connection = con, output.var = "id1"}
# distinct ids for activity table
SELECT COUNT(DISTINCT id) AS users 
FROM `daily_activity`
```
```{sql, connection = con, output.var = "id2"}
# distinct ids for sleep table
SELECT COUNT(DISTINCT id) AS users 
FROM `daily_sleep`
```

Activity data has 33 unique users, and sleep data has 24 unique users. Merging the tables next.
```{sql, connection = con, output.var = "dfn"}
# join activity and sleep data by id and date
CREATE TABLE daily_stats AS
  (SELECT  a.*, s.totalsleeprecords, s.totalminutesasleep
  FROM `daily_activity` a
  LEFT JOIN `daily_sleep` s
  ON a.id = s.id AND a.activitydate = s.date);
```

Now checking for missing/null values.
```{sql, connection = con, output.var = "ntest"}
# check for null values
SELECT *
FROM `daily_stats`
WHERE calories IS NULL;
```

There are no missing/null values from the activity data. The BigQuery database indicates that the entered data and datatypes are all consistent. Now sorting through the data to check for outliers and mistyped data.
```{sql, connection = con, output.var = "mtest"}
# order columns to check for data errors
SELECT *
FROM `daily_stats`
ORDER BY calories DESC
```

There are no apparent incorrect data points. Now identifying and removing any duplicates.
```{sql, connection = con, output.var = "dtest"}
# check for duplicates in joined table
SELECT id, activitydate, COUNT(*)
FROM `daily_stats`
GROUP BY id, activitydate
HAVING COUNT(*) > 1
```

Adding day of week column to the merged table. Dropping tracker distance, logged activities distance, and sedentary active distance columns (redundant information).
```{sql, connection = con, output.var = "dfn"}
# add day of week to final table
SELECT *, EXTRACT(DAYOFWEEK FROM activitydate) AS day
FROM `daily_stats`;
```
```{sql, connection = con, output.var = "dfn"}
# remove columns
ALTER TABLE `daily_stats`
DROP trackerdistance,
DROP loggedactivitiesdistance,
DROP sedentaryactivedistance;
```

Importing updated dataset.
```{r}
dfn <- read_csv('Fitbit-Data/daily_stats.csv')
head(dfn)
```

Performing final date/time transformations (adding weekday column).
```{r}
# transform daily activity day values to weekdays
dfn$Day[dfn$Day == 1] <- "Sunday"
dfn$Day[dfn$Day == 2] <- "Monday"
dfn$Day[dfn$Day == 3] <- "Tuesday"
dfn$Day[dfn$Day == 4] <- "Wednesday"
dfn$Day[dfn$Day == 5] <- "Thursday"
dfn$Day[dfn$Day == 6] <- "Friday"
dfn$Day[dfn$Day == 7] <- "Saturday"

# add weekday column to hourly activity dataset
dfh <- dfh %>%
  mutate(Day = as.Date(Date)) %>%
  mutate(Day = weekdays(Day))

# clean output
hcols <- c('Id', 'Day', 'Date', 'Time', 'StepTotal', 'TotalIntensity', 'AverageIntensity')
dfh <- dfh[, hcols]

head(dfn)
head(dfh)
```


## ANALYSIS

**Usage**
Initial exploratory analysis involves understanding usage patterns. The study spanned exactly one month (31 days), and ideally the majority of users logged data every day. 
```{r}
# user logs data frame 
i_usage <- dfn %>%
  group_by(Id) %>%
  summarize(Logs = sum(n())) %>%
  mutate(UsageActivity = if_else(between(Logs, 1, 15), "Inactive", "Regular"))

head(i_usage)
```
```{r}
# summarizing individual user data
usage <- i_usage %>%
  group_by(UsageActivity) %>%
  summarize(Users = n()) %>%
  mutate(Percent = scales::percent(Users/sum(Users)))

summary(i_usage$Logs)
usage
```

The median user has 31 logs (logged data every day), and the average is ~28 logs. Only one user is categorized as 'Inactive' (not logging at least every other day). Thus the majority of users are at least using trackers to log activity daily. Now viewing usage specific to date / day of week.

```{r}
# usage by date data frame 
d_usage <- dfn %>%
  group_by(ActivityDate) %>%
  summarize(UniqueLogs = sum(n())) %>%
  arrange(UniqueLogs)

# usage by day data frame
dw_usage <- dfn %>%
  group_by(Day) %>%
  summarize(Logs = sum(n()))

dw_usage$Day <- factor(dw_usage$Day, levels = c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"))

head(d_usage)
summary(d_usage$UniqueLogs)
dw_usage

# usage by day plot 
ggplot(dw_usage, aes(x = Day, y = Logs, fill = Day)) + 
  geom_bar(stat = "identity", show.legend = FALSE) + 
  theme(panel.background = element_blank()) + 
  scale_fill_manual(values=c("gainsboro", "gainsboro", "steelblue", "steelblue", "steelblue", "gainsboro", "gainsboro")) + 
  labs(title = "Total Logs by Day of Week")
```
Checking the unique logs per date shows on an average day, almost all the users (median = 32, mean = ~30) logged activity on their tracker. Sorting by day-of-week shows that the total number of logs are generally higher during the mid-week (Tuesday, Wednesday, Thursday) by a slight margin.

**Activity**
Now viewing the general summary statistics for each variable, and user-specific activity data. 
```{r}
# summary of daily activity data
summary(dfn)
```

The initial data summaries suggest most users are generally active (median 7439 steps a day). The vast majority of time is spent being sedentary (expected), and the median time spent in intense activity is only 11 minutes (4 very active minutes + 7 fairly active minutes). The mean intense activity values are much higher for both (21 very active minutes, 13 fairly active minutes) hinting at a skewed distribution likely due to only a small portion of users having a regular workout routine. Users average around ~7 hours of sleep a night on average. Visualizing these distributions next for clarity.

```{r}
# distributions of daily activity data
dfn %>% select(c('TotalSteps', 'TotalDistance', 'VeryActiveMinutes', 'FairlyActiveMinutes', 'LightlyActiveMinutes', 'SedentaryMinutes')) %>% plot_histogram(ncol = 3, ggtheme = theme_light(base_line_size = 0, base_rect_size = 0))
options(repr.plot.width = 21, repr.plot.height = 9)
```

The distributions of the activity variables confirm the initial summaries: active entries are right-skewed (biased by a select few active users) as shown by the skewed distributions of total distance, total steps, very active minutes, and fairly active minutes. The sedentary minutes distributions contrasts this, as expected, since it is left skewed (predominantly high sedentary values, a few active (low minutes) entries) and also bi modal (two peaks). Now checking sleep and calorie variables next.

```{r}
# distributions of sleep and calorie data
dfn %>% select(c('Calories', 'TotalMinutesAsleep')) %>% plot_histogram(ncol = 2, ggtheme = theme_light(base_line_size = 0, base_rect_size = 0))
options(repr.plot.width = 21, repr.plot.height = 9)
```
Viewing the calorie burn distribution, it is slightly right-skewed (aligns with activity data) and centered around ~2000 calories. The time asleep distribution is mostly symmetrical with no obvious outliers.

Taking a more in-depth look at activity data now.
```{r}
# activity data by hour dataframe
dfh_o <- dfh %>%
  group_by (Day, Time) %>% 
  summarize(AverageSteps = mean(StepTotal), AverageIntensity = mean(TotalIntensity), .groups = "drop")

dfh_o$Day <- ordered(dfh_o$Day, levels=c("Monday", "Tuesday", "Wednesday","Thursday","Friday", "Saturday", "Sunday"))
                                 
head(dfh_o)
```
```{r}
# activity data by hour (steps)
ggplot(dfh_o, aes(x = Time, y = Day, fill = AverageSteps)) + 
  theme(axis.text.x = element_text(angle = 90)) +
  labs(title= "Average Activity During the Week", 
       x=" ", y=" ", fill = "Average\nSteps") +
  scale_fill_gradient(low = "white", high = "steelblue") +
  geom_tile(color = "white", lwd = .7, linetype = 1) +
  theme(plot.title = element_text(hjust = 0.5, vjust = 0.7, size = 16),
        panel.background = element_blank()) + 
  coord_fixed()

# activity data by hour (intensity)
ggplot(dfh_o, aes(x = Time, y = Day, fill = AverageIntensity)) + 
  theme(axis.text.x = element_text(angle = 90)) + 
  labs(title= "Average Activity During the Week", 
       x=" ", y=" ", fill = "Average\nIntensity") +
  scale_fill_gradient(low = "white", high = "darkorange") +
  geom_tile(color = "white", lwd = .7, linetype = 1) +
  theme(plot.title = element_text(hjust = 0.5, vjust = 0.7, size = 16),
        panel.background = element_blank()) + 
  coord_fixed()
```
Viewing the step data, users are typically most active around midday on the weekends and late afternoon / early evening on weekdays. Intensity data essentially mirrors the step data, suggesting the users' intense exercise is typically movement-based. Now grouping users based on activity level.

```{r}
# create grouped user data frame
u_dfn <- dfn %>%
  group_by (Id) %>% 
  summarize(AverageSteps = mean(TotalSteps), 
            AverageVeryActiveMinutes = mean(VeryActiveMinutes), 
            AverageFairlyActiveMinutes = mean(FairlyActiveMinutes),
            AverageLightlyActiveMinutes = mean(LightlyActiveMinutes),
            AverageSedentaryMinutes = mean(SedentaryMinutes),
            AverageCalories = mean(Calories),
            AverageTimeAsleep= mean(TotalMinutesAsleep)) %>% 
  # categorize users by activity level (steps)
  mutate(ActivityLevel = case_when(
    AverageSteps < 5000 ~ "Average",
    between(AverageSteps, 5000, 9999) ~ "Active",
    AverageSteps >= 10000 ~ "Very Active"))

u_dfn$ActivityLevel <- factor(u_dfn$ActivityLevel, levels= c("Average", "Active", "Very Active")) 

head(u_dfn)
```
```{r}
# summarize individual activity data
activity <- u_dfn %>%
  group_by(ActivityLevel) %>%
  summarize(Users = n()) %>%
  mutate(Percent = scales::percent(Users/sum(Users)))

activity$ActivityLevel <- factor(activity$ActivityLevel, levels= c("Average", "Active", "Very Active")) 
activity
```
Users were categorized into three different activity groups: Average (<5000 steps), Active (5000-9999 steps), and Very Active (10000+ steps) based on daily average step totals. 

These groups were derived from the Center for Disease Control (CDC) lifestyle recommendations - 
The typical american walks 3000-4000 steps a day -> 'Average' activity for this sample is set for (<5000 steps)
The recommended active lifestyle is upwards of 10000 steps a day -> 'Very Active' activity for this sample is set for above the recommendation (10000> steps)
Users with average step totals between the above levels -> 'Active' users

Over half of the users fall into the 'Active' category (18 users), and an even amount of 'Average' and 'Very Active' users make up the rest of the sample (8 average users, 7 very active users). Now viewing activity trends between groups, as well as relationships between other variables.
```{r}
# compare intensity by activity group (very active)
ggplot(u_dfn, aes(ActivityLevel, AverageVeryActiveMinutes, fill = ActivityLevel)) +
  geom_boxplot(show.legend = FALSE) +
  labs(title= "Daily Intense Activity by Group (Very Active)", 
       x= " ", y = "Average Daily Minutes") + 
  scale_fill_brewer(palette = "Blues") + 
  theme_classic(base_line_size = .25)

# compare intensity by activity group (fairly active)
ggplot(u_dfn, aes(ActivityLevel, AverageFairlyActiveMinutes, fill = ActivityLevel)) +
  geom_boxplot(show.legend = FALSE) +
  labs(title= "Daily Activity by Group (Fairly Active)", 
       x= " ", y = "Average Daily Minutes") + 
  scale_fill_brewer(palette = "Blues") + 
  theme_classic(base_line_size = .25)

# compare intensity by activity group (lightly active)
ggplot(u_dfn, aes(ActivityLevel, AverageLightlyActiveMinutes, fill = ActivityLevel)) +
  geom_boxplot(show.legend = FALSE) +
  labs(title= "Daily Activity by Group (Lightly Active)", 
       x= " ", y = "Average Daily Minutes") + 
  scale_fill_brewer(palette = "Blues") + 
  theme_classic(base_line_size = .25)

# compare intensity by activity group (sedentary)
ggplot(u_dfn, aes(ActivityLevel, AverageSedentaryMinutes, fill = ActivityLevel)) +
  geom_boxplot(show.legend = FALSE) +
  labs(title= "Daily Inactivity by Group (Sedentary)", 
       x= " ", y = "Average Daily Minutes") + 
  scale_fill_brewer(palette = "Blues") + 
  theme_classic(base_line_size = .25)
```
```{r}
# anova test for significant differences in means between groups
# very active minutes
va <- aov(AverageVeryActiveMinutes ~ ActivityLevel, data = u_dfn)
summary(va)

# sedentary minutes
sa <- aov(AverageSedentaryMinutes ~ ActivityLevel, data = u_dfn)
summary(sa)
```
Observing activity distributions between groups via boxplot and ANOVA tests shows that there are significant differences in high intensity activity minutes between groups as expected - 'Very Active' level users are have higher active minutes than 'Average' level users. Similarly, there are significant differences between groups for sedentary minutes as well - 'Average' level users have higher sedentary minutes than 'Very Active' level users.
Interestingly, the median level inactivity in the middle 'Active' group is much lower than the 'Very Active' group (although the range is higher), indicating that there is a select group of users that schedule their day around periods of high-intensity activity while otherwise being generally sedentary.

**Relationships**
Examining correlations between other variables next.
```{r}
# create correlation data frame with activity groups
library(corrplot)
library(ggpubr)

dfcorr <- subset(dfn, select = c('TotalSteps', 'TotalDistance', 'VeryActiveMinutes', 
                                 'FairlyActiveMinutes', 'LightlyActiveMinutes', 'SedentaryMinutes', 
                                 'Calories'))
dfcorr
```
```{r}
# create correlation matrix
corr = cor(dfcorr)
corrplot(corr, type = 'upper', addCoef.col = 'black', tl.cex = .7, diag = FALSE)

```
Looking at the overall linear (Pearson's) correlations between all the variables, the strongest associations are between activity variables (steps, distance, active minutes) as well as calories. Specifically, higher very active and fairly active minutes are strongly related with more steps and distance (r = .67, .68). 

```{r}
# view daily steps vs calories burned
ggplot(dfcorr, aes(TotalSteps, Calories)) + 
  geom_smooth(method = 'loess', formula = y ~ x, color = "steelblue") +
  geom_point(size = .7) + 
  stat_cor(method = "pearson", label.x = 12500, label.y = 25) +
  labs(title= "Daily Steps vs Calories Burned", x = "Daily Steps", y = "Calories Burned") +
  ylim(0, 5000) + xlim(0, 17000) +
  theme_light()

# view daily steps vs sleep time
ggplot(dfn, aes(TotalSteps, TotalMinutesAsleep)) + 
  geom_smooth(method = 'loess', formula = y ~ x, color = "steelblue") +
  geom_point(size = .7) + 
  stat_cor(method = "pearson", label.x = 360, label.y = 25) +
  labs(title= "Daily Steps vs Time Asleep", x = "Daily Steps", y = "Total Minutes Asleep") +
  ylim(0, 700) + xlim(0, 17000) +
  theme_light()
```
Finally, seeing activity (steps) in relation to calories shows that there is a moderate positive correlation between total calories and calories burned (expected). There is no apparent relationship between activity (steps) and time asleep (also expected). Current Fitbit trackers give more detailed insight into sleep time and sleep quality that can be used to better identify sleep habits and relationships with other factors. Additional supplemental visualizations can be viewed on Tableau Public.



## DISCUSSION

**Summary**
Analyzing the activity and sleep data of the sample gives a general idea of the usage of a typical Fitbit tracker. The most immediate observation is that users **do not** log all of the available information from the tracker. Only the daily activity and sleep data met sample size requirements for statistical analysis (~30 users). 
This is interesting to note, as trackers do have advanced capabilities that can give users more detailed insight on their day-to-day health, yet these features are not being used *in this sample*. This should be investigated further in an official future study.

The available activity data showcases a general trend in usage - activity levels are spread across a spectrum. There is a *highly active* subset of users that regularly perform intense workouts, and there is a *sedentary* subset of users that generally limit activity to light movement. The remaining users are spread in-between the two groups. 
The strongest trend is the correlation between intense activity, steps, and distance. This is also seen with the hourly intense activity aligning with hourly steps data. The typical activity of Fitbit users suggests it is mostly running.

Sleep data is also provided, but without the in-depth metrics on sleep phases and sleep quality, it is difficult to attribute any associations between activity patterns and sleep. Most importantly, the **lack of** detailed sleep data in the sample suggests that users may not be inclined to track their sleep patterns in detail.

**RECOMMENDATIONS**

Priority for future product strategy must be centered around increasing device usage.
Higher device usage -> greater user fitness/satisfaction -> more device and service sales

**1. Integrate detailed fitness tracking seamlessly**

As noted in the summary, more detailed data utilizing all aspects of the tracker can help the user better understand their health and activity habits. The Fitbit app allows users to view this at a glance, and it should be easy-to-configure and enabled by default. Since a user is likely purchasing this device to improve their fitness, it should be expected that the tracker is used optimally. Notifications can be centered around encouraging *device usage*, to indirectly help motivate forming consistent healthy exercise habits.

**2. Emphasize social fitness goal-setting**

One of the key features of the Fitbit app is the ability to share progress with friends and family. Social motivation is a strong influence in helping people build a fit lifestyle. This should be the focus of the app in addition to the detailed tracking. The combination of tracking and sharing progress leads individuals towards *using* the device and app above all. 

An important aspect to track while implementing these recommendations is to understand user behavior and perceptions towards fitness data tracking. Studies show that while people look to maintain a healthy lifestyle are inclined to purchase and use fitness trackers, there is fine line between encouragement and pressure. Notifications and tracking cannot cross the ethical boundaries of overwhelming users with data. Thus, future study should be centered around a stronger sample of both regular and irregular users conducted by first-party researchers to get a better grasp of usage tendencies.

**Sources**

Razon, S., Wallace, A., Ballesteros, J., Koontz, N., Judge, L. W., & Montoye, A. H. (2019). Perceptions of physical activity tracking devices: A survey analysis. Physical Educator, 76(1), 258-284.

Lifestyle Facilitation Guide: Centers for Disease Control and Prevention. from https://www.cdc.gov/diabetes/prevention/pdf/postcurriculum_session8.pdf. 

Fitbit App. from https://www.fitbit.com/gb/app 

